{% extends "base.html" %}

{% block content %}

{%if request.user.is_authenticated %}
<div class="layout-content-header">
    <h1 class="page-hero-text">{{ username }}'s Profile</h1>
</div>

<div class="layout-entry-content clearfix-modern">

    <div class="entry-image">
        <img src="/webhost_media/{{up.avatar}}" width="250"/>
    </div>
    <div class="entry-content" width="650">
        <h3>My Interest is {{up.interest}}</h3>
        <h3>My Location is {{up.location}}</h3>
        <h3>My Preference is {{preferences}}</h3>

    </div>
        
</div>


<div id="divInfo"></div>
<script>
  // Additional JS functions here
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '	295417230590753', // App ID
      channelUrl : '//127.0.0.1:8000/events/', // Channel File
      status     : true, // check login status
      cookie     : true, // enable cookies to allow the server to access the session
      xfbml      : true  // parse XFBML
    });
    
    FB.getLoginStatus(function(response) {
        if (response.status === 'connected') {
            // connected
            testAPI();
        } else if (response.status === 'not_authorized') {
            // not_authorized
            login();
        } else {
            // not_logged_in
            login();
        }
    });
    // Additional init code here

  };

  function login() {
    FB.login(function(response) {
        
//        FB.login(handleLogin);
        if (response.authResponse) {
            // connected
            testAPI();
        } else {
            // cancelled
        }
    });
  }

  function testAPI() {
    console.log('Welcome!  Fetching your information.... ');
    FB.api("/me?fields=name,picture", handleMe);
    FB.api("/me/friends?fields=name,picture", handleFriends);
    FB.api('/me', function(response) {
        console.log('Good to see you, ' + response.name + '.');
    });
  }

  function handleMe(response) {
    var divInfo = document.getElementById("divInfo");

    divInfo.innerHTML = "<h1>Me</h1>";
    divInfo.innerHTML += "Name: " + response.name + "<br />";
    divInfo.innerHTML += "Profile: <a href=\"https://www.facebook.com/" + response.id + "\">Profile Link<a/></br>";
    divInfo.innerHTML += "<img src=" + response.picture.data.url + " /><br /><br />";
//    alert(response.toSource())
//    divInfo.innerHTML = "<h1>Test Loop</h1>";
    
//    for (var i = 0; i < friends.length; i++) {
//            divInfo.innerHTML += response[i] + "<br />";
//    }
  }

  function handleFriends(response) {
    var divInfo = document.getElementById("divInfo");

    var friends = response.data;

    divInfo.innerHTML += "<h1>My Friends</h1>";

    for (var i = 0; i < friends.length; i++) {
      divInfo.innerHTML += "Name: " + friends[i].name + "<br />";
      divInfo.innerHTML += "Profile: <a href=\"https://www.facebook.com/" + friends[i].id + "\">Profile Link<a/></br>";
      divInfo.innerHTML += "<img src=" + friends[i].picture.data.url + " /><br /><br />";
    }
  }

  // Load the SDK Asynchronously
  (function(d){
     var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement('script'); js.id = id; js.async = true;
     js.src = "//connect.facebook.net/en_US/all.js";
     ref.parentNode.insertBefore(js, ref);
   }(document));
</script>
<script src="//connect.facebook.net/en_US/all.js"></script>



    <div class="main-item-block main-item-style post-item">
    <h3>Message Sent List: </h3>

    {% for msg in msg_sent_list %}
    <strong>From:</strong> {{msg.msg_from.django_user}}<br>
    <strong>To:</strong>{{msg.msg_to.django_user}}<br>
    <strong>Content:</strong>{{msg.content}}<br>
    <strong>Date:</strong>{{msg.time}}<br>
    {% endfor %}
    </div>


    <div class="main-item-block main-item-style post-item">
    <h3>Message Received List: </h3>

    {% for msg in msg_received_list %}
    <strong>From:</strong> {{msg.msg_from.django_user}}<br>
    <strong>To:</strong>{{msg.msg_to.django_user}}<br>
    <strong>Content:</strong>{{msg.content}}<br>
    <strong>Date:</strong>{{msg.time}}<br>
    {% endfor %}
    </div>
        
        
        
    <div class="main-item-block main-item-style post-item">
    <h3>My Event Preferenced is{{eventPreferenced}}:</h3>
    <br>
    {% for event in eventPreferenced %}
        <p>Event Title: {{event.title}}</p>
        <p>Event Body: {{event.body}}</p>
    {% endfor %}
    </div>
    
    <div class="main-item-block main-item-style post-item">
    {% for like in likes %}
        <p>This user liked: {{ like.event }}</p>
    {% endfor %}
    </div>
        

    <div class="main-item-block main-item-style post-item">
    <h3>Friends List: </h3>
	{% for friend in friends %}
        <p>{{ friend.friend_to.django_user }}</p>
     {% endfor %}
    </div>

    <div class="main-item-block main-item-style post-item">

    {{friends_events|length}}
    <h3>Friends Events List: </h3>
	{% for event in friends_events %}
        <h2><a href="{% url single event.id %}">{{ event.title }}</a></h2>
    	   <div class="event-meta">
        {{ event.created }}
	   <br>
         </div>
     {% endfor %}
    </div>


    
{%endif%}
    
{% endblock %}
